<div class="row">
  <div class="small-8 columns content-title">
    <h1>Bitcore Transaction Demo</h1>
  </div>
  <div class="small-4 columns text-right">
    <a href="{{serialize()|permalink:'keys'}}" class="share-link fnt08"><i class="fi-share"></i> SHARE THIS</a>
  </div>
</div>

<div class="row">
  <div class="small-4 columns bg-color-white white-box radius p20">
    <div class="row">
      <div class="small-12 columns">
        <h2 class="text-center">Unspent Outputs</h2>    
        <!-- Fetch unspent form -->
        <input type="text" ng-model="utxoAddress" placeholder="enter an address" class="radius" address auto-select> 
        <button type="button" ng-click="fetchUTXO(utxoAddress)" class="button expand tiny radius button1 mt5">Fetch</button>
        
          <div class="row" ng-repeat="utxo in utxos">
            <div class="small-12 columns">
              <div class="capsule-inside p5 mt5 mb5">
                <div class="text-center">
                  <h1 class="amount fnt09">{{utxo.satoshis|btc}}<span class="btc"> BTC</span></h1>
                </div>
                <button type="button" ng-click="addUTXO(utxo)" class="button expand radius button2 fnt06">Move to inputs</button>
                <div ng-show="utxo.visible">
                  <div class="more-info-data">
                      <div class="fnt08 mt5"><span class="item-title">TX ID:</span> <span class="item-data fntgrey1">{{utxo.txId}}</span></div>
                      <div class="fnt08 mt5"><span class="item-title">OUT #:</span> <span class="item-data fntgrey1">{{utxo.outputIndex}}</span></div>
                      <div class="fnt08 mt5"><span class="item-title">Script:</span> <span class="item-data fntgrey1">{{utxo.script.toString()}}</span></div>
                  </div>
                </div>
                <div class="fnt06 text-center more-info pt5">
                  <a ng-hide="utxo.visible" ng-click="utxo.visible = true">More info</a>
                </div>
                <div class="fnt06 text-center less-info">
                  <a ng-show="utxo.visible" ng-click="utxo.visible = false">Less info</a>
                </div>
              </div>
            </div>
          </div>
      </div>
    </div>
  </div>

  <div class="small-8 columns">
    <div class="row">
      <div class="small-11 small-offset-1 columns bg-color-white white-box radius p20">
        <h2 class="text-center">Transaction</h2>
          <div class="row border-bottom">
            <div class="small-6 columns  pt10 pb10">
              <span class="item-title">TX ID:</span> <span class="item-data fntgrey1">{{transaction.id}}</span>
            </div>
            <div class="small-6 columns text-right pt10 pb10">
              <span class="item-title">nLockTime:</span> <span class="item-data fntgrey1">{{transaction.nLockTime}}</span>
            </div>
          </div>
          <div class="row border-bottom">
            <div class="small-6 columns pt10 pb10">
              <span class="item-title">Total Inputs:</span> <span class="item-data fntgrey1">{{transaction._inputAmount | btc}}</span>
            </div>
            <div class="small-6 columns pt10 pb10">
              <div class="row">
                <div class="small-6 columns">
                  <span class="item-title">Total Outputs: </span> <span class="item-data fntgrey1">{{transaction._outputAmount | btc}}</span>
                </div>
                <div class="small-6 columns text-right">
                  <span class="item-title">Fee:</span> <span class="item-data fntgrey1"> {{transaction.getFee() | btc}}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="small-6 columns vertical-sep mt20">
              <h2 class="text-center">Inputs</h2>

              <!-- Sign inputs form -->
              <div class="row collapse">
                <div class="small-3 columns input-title">
                  <span class="prefix-clean prefix">Sign all input</span>
                </div>
                <div class="small-8 columns">
                  <input type="text" placeholder="enter a private key" ng-model="privkey" private-key auto-select>
                </div>
              </div>
              <div class="row collapse">
                <div class="small-8 small-offset-4 columns">
                  <button type="button" ng-click="signWith(privkey)" class="expand radius tiny button1 mt5">Sign</button>
                </div>
              </div>

              <div class="row capsule-inside p5 mt5 mb5" ng-repeat="input in transaction.inputs">
                <div class="small-12 columns">
                  <div class="row collapse">
                    <div class="small-10 columns">
                      <h1 class="amount fnt09">{{input.output.satoshis|btc}}<span class="btc"> BTC</span></h1>
                    </div> 
                    <div class="small-1 columns">
                      <div class="small-1 columns"><i class="fi-check check"></i></div>
                    </div> 
                    <div class="small-1 columns">
                      <div class="small-1 columns"><a ng-click="removeInput(input)"><i class="fi-x"></i></a></div>
                    </div> 
                  </div>
                  <div class="row collapse">
                    <div class="fnt06 text-center more-info pt5">
                      <a ng-hide="input.visible" ng-click="input.visible = true">More Info</a>
                    </div>
                    <div class="fnt06 text-center less-info">
                      <a ng-show="input.visible" ng-click="input.visible = false">Less Info</a>
                    </div>
                  </div>
                </div>

                <div class="row" ng-show="input.visible">
                  TX ID: {{input.prevTxId.toString('hex')}}<br>
                  OUT #: {{input.outputIndex}}<br>
                  Script: {{input.output.script.toString()}}
                </div>
               
              </div>



            </div>

            <div class="small-6 columns mt20">
              <h2 class="text-center">Outputs</h2>

              <div class="row">
                <div class="small-6 columns">
                  <button type="button" ng-click="displayAddAddress = !displayAddAddress" class="expand button tiny radius button1"><i class="fi-plus"></i> Add Address</button>
                  <div class="small-4 small-push-1 columns" ng-show="displayAddAddress">
                    <input type="text" ng-model="toAddress" placeholder="enter an address" address auto-select>
                    <input type="number" ng-model="amount" placeholder="enter an amount" auto-select>
                    <button type="button" ng-click="addAddressOutput(toAddress, amount)">Send to Address</button>
                  </div>
                </div>
                <div class="small-6 columns">
                  <button type="button" ng-click="displayAddData = !displayAddData" class="expand button tiny radius button1"><i class="fi-plus"></i> Add Data</button>
                  <div class="small-4 small-push-1 columns" ng-show="displayAddData">
                    <input type="text" ng-model="info" placeholder="enter an hexa or normal string" auto-select>
                    <button type="button" ng-click="addDataOutput(info)">+ Add Data</button>
                  </div>
                </div>
              </div>

              <div class="row" ng-repeat="output in transaction.outputs">
                <div class="row">
                  <div class="small-4 columns" ng-show="output.script.isScriptHashOut() || output.script.isPublicKeyHashOut()">
                    {{output.satoshis|btc}} to {{output.script.toAddress().toString()}}
                  </div>
                  <div class="small-4 columns" ng-show="output.script.isDataOut()">
                    OP_RETURN with data: 0x{{output.script.getData().toString('hex')}}
                  </div>
                  <div class="small-4 columns" ng-hide="output.script.isScriptHashOut() || output.script.isPayToPublicKeyHash() || output.script.isDataOut">
                    {{output.satoshis|btc}} to an unrecognized script
                  </div>
                  <div class="small-2 columns">
                    <a ng-hide="output.visible" ng-click="output.visible = true">More Info</a>
                    <a ng-show="output.visible" ng-click="output.visible = false">Less Info</a>
                  </div>
                  <div class="small-1 columns"><a ng-click="removeOutput($index)">X</a></div>
                </div>

                <div class="row" ng-show="output.visible">
                  Script: {{output.script.toString()}}
                </div>
              </div>
            </div>
          </div>
    </div>

    <div class="small-11 small-offset-1 columns bg-color-white white-box radius plr25por mt5">
        <div class="row">
          <textarea rows=5>Transaction</textarea>
        </div>
</div>
  </div>
  </div>
</div>

<div class="row">
  <div class="explanation">
    <h3 class="fnt1">This is how it works</h3>
    <div class="large-5 columns">
      <p>Bitcore provides a simple API for transaction creation - just specify outputs corresponding to an address that you control, a private key, and where do you want to spend your bitcoins (and optionally, whatever information would you like to record in the blockchain as an <tt>OP_RETURN</tt> output).</p>
      <p><a href=”http://bitcore.io/guide/transaction.html”>Read more in the bitcore developer guide</a></p>
    </div>
    <div class="large-7 columns">
      <pre><code class="javascript" example-code="exampleCode">
      </code></pre>
    </div>
  </div>
</div>
